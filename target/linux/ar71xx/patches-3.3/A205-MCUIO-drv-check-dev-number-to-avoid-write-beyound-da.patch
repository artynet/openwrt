From aa0a49f5cf7928783902d86a3316e379a564d509 Mon Sep 17 00:00:00 2001
From: Aurelio Colosimo <aurelio@aureliocolosimo.it>
Date: Sat, 28 Nov 2015 11:18:54 +0100
Subject: [PATCH 30/50] MCUIO: drv, check dev number to avoid write beyound
 data->irqs size

Signed-off-by: Aurelio Colosimo <aurelio@aureliocolosimo.it>
---
 drivers/mcuio/mcuio-hc-drv.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/mcuio/mcuio-hc-drv.c b/drivers/mcuio/mcuio-hc-drv.c
index 0aa8ff1..052afdc 100644
--- a/drivers/mcuio/mcuio-hc-drv.c
+++ b/drivers/mcuio/mcuio-hc-drv.c
@@ -487,6 +487,10 @@ int mcuio_hc_set_irqs(struct mcuio_device *hc, unsigned dev, int __irqs[])
 		WARN_ON(1);
 		return -ENODEV;
 	}
+	if (dev > MCUIO_DEVS_PER_BUS) {
+		dev_warn(&hc->dev, "Invalid dev number %u\n", dev);
+		return -EINVAL;
+	}
 	irqs = devm_kzalloc(&hc->dev, size, GFP_KERNEL);
 	if (!irqs) {
 		dev_err(&hc->dev, "No memory for irqs for %u:%u\n", hc->bus,
-- 
2.8.2

